---
title: Meta-analysis of composite outcomes in clinical trials 
author:
  - name: Athira Mohan
  - name: Brendan Woods
    affil: 1
affiliation:
  - num: 1
    address: School of Mathematical and Statistical Sciences, University of Galway
logoleft_name: https&#58;//sport.universityofgalway.ie/assets/img/logo2.png

poster_height: "594mm"
poster_width: "841mm"
column_numbers: 4
column_margins: "0.5in"	
primary_colour:	"#a80050"	# Secondary colour use for poster design.
secondary_colour:	"#84003d"	# Main colour used for poster design.
accent_colour:	"#e6007e"	# A third colour option.
author_textcol: "white"
title_textsize: "80pt"
author_textsize: "60pt"
body_textsize: "25pt"
output: 
  posterdown::posterdown_html:
    self_contained: true
    pandoc_args: --mathjax
    number_sections: false
knit: pagedown::chrome_print
---

```{css, echo=FALSE}
div.logo_left{
  width: 20%;
}
div.poster_title{
  width: 80%;
}
.section h4 {
    break-after: column;
}
div.footnotes {
    font-size: 18pt;
}
```

<!-- Don't change anything above, except the title and author names, unless you know what you are doing. -->

```{r, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      tidy = FALSE,
                      message = FALSE,
                      fig.align = 'center',
                      out.width = "100%")
options(knitr.table.format = "html") 
# Load any additional libraries here
library(tidyverse)
library(plotly)
library(kableExtra)
library(posterdown)
library(ggplot2)
load("\\Users\\brend\\Downloads\\data")
tmpDat$binary_insulin<-0
tmpDat$binary_insulin[tmpDat$InsulinYN == "Yes"]<-1


thesis.df<-tmpDat

insulin_t_value<-t.test(tmpDat$binary_insulin[tmpDat$Group == "Metformin"], tmpDat$binary_insulin[tmpDat$Group == "Placebo"])$statistic
gw32_t_value<-t.test(tmpDat$gw32[tmpDat$Group == "Metformin"], tmpDat$gw32[tmpDat$Group == "Placebo"])$statistic
gw38_t_value<-t.test(tmpDat$gw38[tmpDat$Group == "Metformin"], tmpDat$gw38[tmpDat$Group == "Placebo"])$statistic
study_squared_composite<-(insulin_t_value^2)+(gw32_t_value^2)+(gw38_t_value^2)

```

# Background and Problem

This template has been produced using the `posterdown` package. It generates a standard conference-style poster layout.

<!-- You can add references by inserting the following ^[reference details here] -->

A common problem in clinical research is messed up data[^1]. It can lead to bias or nonsensical results. Appropriate statistical analysis can result in superb findings in such cases, with the right assumptions.

[^1]: Evans 2010, doi: 10.6030/1939-067x-3.1.1

## Objectives of Project

1.  Explain the statistical issue or research question in health data science to be investigated.
2.  Explore a method of analysis.
3.  Apply any methods to selected datasets.

# Data Sources and Datasets

The syntax in this poster template and the `posterdown` package uses the same workflow approach as the R Markdown you know and love.

You can even use the bibliography the same way: Our data were taken from a cluster-randomised trial [^2], available from the [Irish Social Science Data Archive](https://www.ucd.ie/issda/data/).

[^2]: Murphy et al. 2005 doi: 10.1186/1468-6708-6-11

<!-- This #### below causes the columns to break -->

<!-- You can change where you put these breaks, and the "column_numbers: 4" argument in the YAMLS header to change the layout of the poster, with care! -->

#### 

# Descriptive Statistics of Datasets

Usually you want to have a nice table displaying some important results that you have calculated. In `posterdown` this is as easy as using the `kable` table formatting you are probably use to as per typical R Markdown formatting.

You can reference tables like so: Table \@ref(tab:mytable). Some basic summaries of the dataset are below:

```{r mytable, out.width='80%'}
knitr::kable(iris[1:10, 1:4], caption = 'Table caption.',align = 'c',"html") %>%
  kable_styling(font_size = 20)
```

Figure \@ref(fig:standard-plot), and Figure \@ref(fig:morefigs) below show the patterns in our dataset. Make sure that all the details in your plots will be legible when printed (legend text, axis text, and any labels)

```{r standard-plot, out.width='80%', fig.align='center', fig.cap='Great figure!', fig.height=4}
ggplot(mpg, aes(displ, hwy, colour = class)) + 
  geom_point()
```

# Methodology
The meta-analysis of the EMERGE outcomes used permutation tests, which generate a null distribution by randomly shuffling the treatment group assignments of participants and their outcome variables. This breaks any true relationship between treatment and outcomes. Statistical significance is assessed by comparing the actual test statistic to the distribution of test statistics from these shuffled datasets. The P-value is calculated as the proportion of the null distribution that is more extreme than the observed test statistic.

The power of the permutation test is estimated using sampling with replacement. Participants are randomly resampled from the original data, allowing duplicates, while maintaining equal numbers from both treatment groups. The test is repeated multiple times, and power is determined by the proportion of resampled subsets yielding test statistics more extreme than the significance threshold.


# Early Results 
```{r morefigs, out.width='90%', echo=FALSE, fig.cap='Permuted Null Distribution of Composite', fig.height=6}
continuous_permutation_function<-function(x){
  permutation_t_value<-numeric(10000)
  i <-1
  repeat{
    thesis.df$Group<-sample(thesis.df$Group, 535, replace = F)
    permutation_result<-t.test(x[thesis.df$Group == "Metformin"], x[thesis.df$Group == "Placebo"])
    permutation_t_value[i]<-permutation_result$statistic
    i<- i +1
    if(i > 10000) break}
  return(permutation_t_value)
}
squared_composite<-((continuous_permutation_function(thesis.df$binary_insulin))^2) +
  ((continuous_permutation_function(thesis.df$gw32))^2) +
  ((continuous_permutation_function(thesis.df$gw38))^2)
percentile_95<-quantile(squared_composite, 0.95)

squared_composite.df<-data.frame(squared_composite)
ggplot(squared_composite.df, aes(x= squared_composite))+
  geom_histogram(bins = 200, fill = "darkslategrey", color = "darkslategrey")+
  scale_x_continuous(limits = c(0, 30)) +
  labs(x = "Squared Composite", y = "Frequency", title = "Permuted Test Statistics") +
  geom_vline(xintercept = percentile_95, color = "darkred", linetype = "dashed", size = 1)+
  annotate("text", x = percentile_95, y = 250, label = "95th Percentile", color = "darkred", angle = 90, vjust = -0.5, size = 7)+
  theme_minimal()+
  theme(axis.title = element_text( size = 24),
        axis.text = element_text(size = 18),
        plot.title = element_text(size = 28))+
  geom_vline( xintercept = study_squared_composite, color = "gold3", size = 1 )+
  annotate("text", x = study_squared_composite, y = 250, label = "EMERGE Composite", color = "gold3", angle = 90, vjust = -0.5, size = 7)


```



```{r morefigs2, out.width='90%', echo=FALSE, fig.cap='Power of Permutation Test', fig.height=5}
APPLE<-7.881899
power_n_30<-0.219598
power_n_40<-0.264418
power_n_50<-0.314862
power_n_60<-0.367066
power_n_70<-0.418002
power_n_80<-0.468156
power_results<-c(power_n_30, power_n_40, power_n_50, power_n_60, power_n_70, power_n_80)
sample_size<-c(30, 40, 50, 60, 70, 80)

power_graph.df<-data.frame(sample_size, power_results)
ggplot(power_graph.df, aes(x=sample_size, y=power_results)) +
  geom_line( color="mediumseagreen", size=1.5, alpha=0.9, linetype=1) +
  theme_bw() + labs(title = "Power vs. Sample Size", x = "Sample Size", y= "Power")+
  scale_x_continuous(limits = c(30, NA), expand = c(0, 0))  +
  ylim(0, NA)+
  theme(axis.title = element_text(size = 24),
         axis.text = element_text(size = 18),
        plot.title = element_text(size = 28))


```



# Next Project Steps

The next steps in our project is to compare the permutation method with other
approaches to improving the analysis of composite outputs, in particular to the
methods described by Mc Menamin *et al,* [^5].



[^5]: Mc Menamin *et al,* 2018 doi:https://doi.org/10.1186/s13023-018-0819-1


# GitHub

The code and datasets for this project can be viewed at our GitHub repository here: <https://github.com/Brendan-G-Woods/Thesis>



# References



